<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Resultado</title>
  <style>
    :root {
      --bg: #111;
      --container-rgba: rgba(0, 0, 0, 0.6);
      --text: #fff;
      --title: #eee;
    }
    html, body { height: 100% }
    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 10px 100px;
      transition: background-color 0.25s, color 0.25s;
    }

    #capture-area { position: relative; }

    .result-container {
      width: 500px;
      background: var(--container-rgba);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
      overflow: hidden;
    }

    h1 {
      margin-bottom: 20px;
      color: var(--title);
      cursor: text;
      outline: none;
      text-align: center;
      transition: color 0.3s;
      text-shadow: 0 1px 0 rgba(0,0,0,0.4);
    }

    .result {
      display: flex;
      align-items: center;
      margin: 10px 0;
      gap: 6px;
    }

    .percent {
      min-width: 60px;
      text-align: right;
      font-weight: bold;
      cursor: text;
    }

    .bar {
      flex: 1;
      height: 8px;
      background-color: rgba(0,0,0,0.35);
      border-radius: 4px;
      overflow: hidden;
    }

    .fill {
      height: 100%;
      width: 0%;
      background: limegreen;
      border-radius: 4px;
      transition: width 0.5s ease-in-out, background-color 0.3s;
    }

    .name {
      font-size: 20px;
      width: 165px;
      text-align: left;
      cursor: text;
      text-shadow: 0 1px 0 rgba(0,0,0,0.4);
      min-height: 18px;
    }

    .remove-btn {
      background: none;
      border: none;
      color: #f55;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      padding: 0 6px;
    }
    .remove-btn:hover { color: #ff7777 }

    .section {
      background: #1b1b1b;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 10px;
      margin-top: 15px;
      width: 520px;
    }

    .section h2 {
      font-size: 15px;
      color: #ccc;
      text-align: center;
      margin-bottom: 6px;
    }

    .font-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .font-controls label {
      font-size: 13px;
      color: #aaa;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .buttons {
      display: flex;
      gap: 10px;
      margin-top: 16px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .buttons button, .buttons label {
      background-color: #222;
      color: #fff;
      border: 1px solid #555;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }
    .buttons button:hover { background: #333 }

    input[type="file"] { display: none }
    input[type="color"] { width: 36px; height: 26px; padding: 0; border: none; }

    #download {
      background: #1ed760;
      font-weight: bold;
      color: #000;
      border: none;
      font-size: 14px;
      padding: 10px 18px;
      border-radius: 8px;
      margin-top: 25px;
    }
    #download:hover { background: #29f07d }

    .wd-watermark {
      position: absolute;
      right: 10px;
      bottom: 8px;
      font-size: 13px;
      opacity: 0.45;
      color: #fff;
      pointer-events: none;
      text-shadow: 0 1px 0 rgba(0,0,0,0.6);
    }

    .hide-during-screenshot { display: none !important }
  </style>
</head>
<body>
  <div id="capture-area">
    <div class="result-container" id="results-container">
      <h1 contenteditable="true" id="editable-title">Resultado de [seu nick]</h1>
      <div id="results"></div>
    </div>
  </div>

  <div class="buttons">
    <button id="addLine">Adicionar linha</button>
    <button id="resetData">Resetar informações</button>
    <button id="resetColors">Resetar cores</button>
    <button id="resetAll">Resetar tudo</button>
    <button id="randomize">Aleatórios</button>
    <button id="ascending">Crescente</button>
    <button id="descending">Decrescente</button>
    <button id="shuffleNames">Embaralhar nomes</button>
    <label for="bgImageInput">Escolher imagem</label>
    <input id="bgImageInput" type="file" accept="image/*">
    <button id="removeImage">Remover imagem</button>
  </div>

  <!-- Cores principais -->
  <div class="section">
    <h2>Alterar Cores</h2>
    <div class="font-controls">
      <label>Fundo <input type="color" id="bgColor" value="#111111"></label>
      <label>Container <input type="color" id="containerColor" value="#000000"></label>
      <label>Título <input type="color" id="titleColor" value="#eeeeee"></label>
      <label>Texto <input type="color" id="textColor" value="#ffffff"></label>
    </div>
  </div>

  <!-- Controles de fonte do título -->
  <div class="section">
    <h2>Editar Título</h2>
    <div class="font-controls">
      <label>Fonte
        <select id="titleFont">
          <option value="Arial">Arial</option>
          <option value="Verdana">Verdana</option>
          <option value="'Times New Roman'">Times New Roman</option>
          <option value="Impact">Impact</option>
          <option value="Comic Sans MS">Comic Sans</option>
        </select>
      </label>
      <label><input type="checkbox" id="titleBold"> Negrito</label>
      <label><input type="checkbox" id="titleItalic"> Itálico</label>
      <label>Sombra <input type="color" id="titleShadowColor" value="#000000"></label>
    </div>
  </div>

  <!-- Controles de fonte dos inputs -->
  <div class="section">
    <h2>Editar Itens</h2>
    <div class="font-controls">
      <label>Fonte
        <select id="inputFont">
          <option value="Arial">Arial</option>
          <option value="Verdana">Verdana</option>
          <option value="'Times New Roman'">Times New Roman</option>
          <option value="Impact">Impact</option>
          <option value="Comic Sans MS">Comic Sans</option>
        </select>
      </label>
      <label><input type="checkbox" id="inputBold"> Negrito</label>
      <label><input type="checkbox" id="inputItalic"> Itálico</label>
      <label>Sombra <input type="color" id="inputShadowColor" value="#000000"></label>
    </div>
  </div>

  <button id="download">Baixar imagem</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    const resultsEl = document.getElementById('results');
    const titleEl = document.getElementById('editable-title');
    const resultsContainer = document.getElementById('results-container');

    const bgColor = document.getElementById('bgColor');
    const containerColor = document.getElementById('containerColor');
    const titleColor = document.getElementById('titleColor');
    const textColor = document.getElementById('textColor');

    const titleFontSel = document.getElementById('titleFont');
    const titleBold = document.getElementById('titleBold');
    const titleItalic = document.getElementById('titleItalic');
    const titleShadow = document.getElementById('titleShadowColor');

    const inputFontSel = document.getElementById('inputFont');
    const inputBold = document.getElementById('inputBold');
    const inputItalic = document.getElementById('inputItalic');
    const inputShadow = document.getElementById('inputShadowColor');

    const DEFAULT = {
      title: 'Resultado de [seu nick]',
      lines: Array.from({length:10}, (_,i)=>({
        percent:`${(i+1)*10}%`,
        name:`Item ${i+1}`
      }))
    };

    function createLine(percent='0%', name='Item'){
      const div=document.createElement('div');
      div.className='result';
      div.innerHTML=`
        <div class="percent" contenteditable="true">${percent}</div>
        <div class="bar"><div class="fill"></div></div>
        <div class="name" contenteditable="true">${name}</div>
        <button class="remove-btn">×</button>
      `;
      resultsEl.appendChild(div);
      updateBars();
    }

    function updateBars(){
      document.querySelectorAll('.result').forEach(r=>{
        const p=r.querySelector('.percent');
        const fill=r.querySelector('.fill');
        let val=parseInt(p.textContent.replace('%',''))||0;
        val=Math.max(0,Math.min(100,val));
        fill.style.width=val+'%';
        fill.style.background= val>80?'limegreen':val>60?'yellowgreen':val>40?'orange':val>20?'orangered':'red';
        p.textContent=val+'%';
      });
    }

    function saveData(){
      const data={
        title:titleEl.textContent,
        lines:[...document.querySelectorAll('.result')].map(r=>({
          percent:r.querySelector('.percent').textContent,
          name:r.querySelector('.name').textContent
        })),
        bg:bgColor.value,
        container:containerColor.value,
        titleColor:titleColor.value,
        textColor:textColor.value
      };
      localStorage.setItem('degeneradoData',JSON.stringify(data));
    }

    function loadData(){
      resultsEl.innerHTML='';
      const raw=localStorage.getItem('degeneradoData');
      let data;
      try{data=raw?JSON.parse(raw):DEFAULT}catch{data=DEFAULT}
      titleEl.textContent=data.title||DEFAULT.title;
      (data.lines||DEFAULT.lines).forEach(l=>createLine(l.percent,l.name));

      bgColor.value=data.bg||"#111111";
      containerColor.value=data.container||"#000000";
      titleColor.value=data.titleColor||"#eeeeee";
      textColor.value=data.textColor||"#ffffff";

      document.body.style.backgroundColor=bgColor.value;
      resultsContainer.style.backgroundColor=containerColor.value;
      titleEl.style.color=titleColor.value;
      document.querySelectorAll('.name,.percent').forEach(e=>e.style.color=textColor.value);

      updateBars();
    }

    /*
                                              ░░░░░░░░░░░░░░░░░░░░░░█████████░░░░░░░░░
                                              ░░███████░░░░░░░░░░███▒▒▒▒▒▒▒▒███░░░░░░░
                                              ░░█▒▒▒▒▒▒█░░░░░░░███▒▒▒▒▒▒▒▒▒▒▒▒▒███░░░░
                                              ░░░█▒▒▒▒▒▒█░░░░██▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██░░
                                              ░░░░█▒▒▒▒▒█░░░██▒▒▒▒▒██▒▒▒▒▒▒██▒▒▒▒▒███░
                             SALVE            ░░░░░█▒▒▒█░░░█▒▒▒▒▒▒████▒▒▒▒████▒▒▒▒▒▒██
                               DO             ░░░█████████████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██
                              DEGE            ░░░█▒▒▒▒▒▒▒▒▒▒▒▒█▒▒▒▒▒▒▒▒▒█▒▒▒▒▒▒▒▒▒▒▒██
                                              ░██▒▒▒▒▒▒▒▒▒▒▒▒▒█▒▒▒██▒▒▒▒▒▒▒▒▒▒██▒▒▒▒██
                                              ██▒▒▒███████████▒▒▒▒▒██▒▒▒▒▒▒▒▒██▒▒▒▒▒██
                                              █▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█▒▒▒▒▒▒████████▒▒▒▒▒▒▒██
                                              ██▒▒▒▒▒▒▒▒▒▒▒▒▒▒█▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██░
                                              ░█▒▒▒███████████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██░░░
                                              ░██▒▒▒▒▒▒▒▒▒▒████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█░░░░░
                                              ░░████████████░░░█████████████████░░░░░░
    */

    document.body.addEventListener('input',e=>{
      if(e.target.matches('.percent,.name,#editable-title')){updateBars();saveData();}
    });
    document.body.addEventListener('click',e=>{
      if(e.target.classList.contains('remove-btn')){e.target.parentElement.remove();saveData();}
    });

    // Cores
    [bgColor,containerColor,titleColor,textColor].forEach(el=>{
      el.addEventListener('input',()=>{
        document.body.style.backgroundColor=bgColor.value;
        resultsContainer.style.backgroundColor=containerColor.value;
        titleEl.style.color=titleColor.value;
        document.querySelectorAll('.name,.percent').forEach(e=>e.style.color=textColor.value);
        saveData();
      });
    });

    // Fontes
    function applyFonts(){
      titleEl.style.fontFamily=titleFontSel.value;
      titleEl.style.fontWeight=titleBold.checked?'bold':'normal';
      titleEl.style.fontStyle=titleItalic.checked?'italic':'normal';
      titleEl.style.textShadow=`1px 1px 2px ${titleShadow.value}`;

      document.querySelectorAll('.name,.percent').forEach(el=>{
        el.style.fontFamily=inputFontSel.value;
        el.style.fontWeight=inputBold.checked?'bold':'normal';
        el.style.fontStyle=inputItalic.checked?'italic':'normal';
        el.style.textShadow=`1px 1px 2px ${inputShadow.value}`;
      });
      saveData();
    }

    [titleFontSel,titleBold,titleItalic,titleShadow,
     inputFontSel,inputBold,inputItalic,inputShadow]
     .forEach(el=>el.addEventListener('input',applyFonts));

    // Botões principais
    document.getElementById('addLine').onclick=()=>{createLine('0%','Novo item');saveData();}
    document.getElementById('resetData').onclick=()=>{localStorage.removeItem('degeneradoData');loadData();}
    document.getElementById('resetColors').onclick=()=>{bgColor.value="#111111";containerColor.value="#000000";titleColor.value="#eeeeee";textColor.value="#ffffff";applyFonts();loadData();}
    document.getElementById('resetAll').onclick=()=>{localStorage.clear();loadData();}

    // Randomizações
    const genRandomArray=l=>Array.from({length:l},()=>Math.floor(Math.random()*101));
    document.getElementById('randomize').onclick=()=>{
      document.querySelectorAll('.result').forEach(r=>{
        r.querySelector('.percent').textContent=Math.floor(Math.random()*101)+'%';
      });updateBars();saveData();
    }
    document.getElementById('ascending').onclick=()=>{
      const items=[...document.querySelectorAll('.result')];
      const vals=genRandomArray(items.length).sort((a,b)=>a-b);
      items.forEach((r,i)=>r.querySelector('.percent').textContent=vals[i]+'%');
      updateBars();saveData();
    }
    document.getElementById('descending').onclick=()=>{
      const items=[...document.querySelectorAll('.result')];
      const vals=genRandomArray(items.length).sort((a,b)=>b-a);
      items.forEach((r,i)=>r.querySelector('.percent').textContent=vals[i]+'%');
      updateBars();saveData();
    }
    document.getElementById('shuffleNames').onclick=()=>{
      const names=[...document.querySelectorAll('.name')].map(n=>n.textContent);
      for(let i=names.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[names[i],names[j]]=[names[j],names[i]];}
      document.querySelectorAll('.name').forEach((n,i)=>n.textContent=names[i]);
      saveData();
    }

    // Imagem
    document.getElementById('bgImageInput').addEventListener('change',ev=>{
      const f=ev.target.files[0];if(!f)return;
      const r=new FileReader();
      r.onload=e=>{resultsContainer.style.backgroundImage=`url('${e.target.result}')`;};
      r.readAsDataURL(f);
    });
    document.getElementById('removeImage').onclick=()=>resultsContainer.style.backgroundImage='';

    // Download
    document.getElementById('download').onclick = async () => {
  // Esconde botões e controles
  document.querySelectorAll('.buttons,.section,.remove-btn').forEach(el => el.classList.add('hide-during-screenshot'));

  // Marca d'água temporária
  const wm = document.createElement('div');
  wm.className = 'wd-watermark';
  wm.textContent = 'Feito no site do DEGE :3';
  resultsContainer.appendChild(wm);

  // Pergunta o tamanho ao usuário
  const sizeInput = prompt("Digite o tamanho da imagem (ex: 500x500) ou deixe em branco para automático:");
  let width, height;
  if (sizeInput && sizeInput.includes('x')) {
    [width, height] = sizeInput.split('x').map(n => parseInt(n.trim()) || null);
  }

  // Captura a área
  const originalCanvas = await html2canvas(document.getElementById('capture-area'), {
    scale: 2,
    backgroundColor: null
  });

  // Se o usuário digitou algo válido, redimensiona
  let finalCanvas = originalCanvas;
  if (width && height) {
    const resizedCanvas = document.createElement('canvas');
    resizedCanvas.width = width;
    resizedCanvas.height = height;
    const ctx = resizedCanvas.getContext('2d');
    ctx.drawImage(originalCanvas, 0, 0, width, height);
    finalCanvas = resizedCanvas;
  }

  // Faz o download
  const a = document.createElement('a');
  a.download = 'resultado.png';
  a.href = finalCanvas.toDataURL();
  a.click();

  // Limpa
  wm.remove();
  document.querySelectorAll('.buttons,.section,.remove-btn').forEach(el => el.classList.remove('hide-during-screenshot'));
};


    loadData();
  </script>
</body>
</html>
